### 4  Work Engine & Execution Loop — Detailed Requirements
*(The execution environment is treated as a **Work World**.
Human participants connect to this Work World through a browser session acting as `HumanWorker`; every event addressed to the `HumanWorker` is delivered to, and visible in, that live session.)*

| ID | Feature | Functional Requirements |
|----|---------|-------------------------|
| **4.1** | **Scheduler & Orchestrator** | 4.1.1 Pull ready tasks from WBS queue; apply priority, dependency, and SLA rules. <br />4.1.2 Allocate workload to Agent or Human Worker respecting concurrency & quota limits. <br />4.1.3 Support cron-like triggers and event-driven re-schedules (e.g., artifact updated). <br />4.1.4 Provide traceable schedule log explaining why and when each task was dispatched. <br />4.1.5 Auto-pause the entire Work when the tenant enters “suspended” state. |
| **4.2** | **Agent-Loop Runtime** | 4.2.1 Instantiate Action Agent with task context (system prompt, input schema, tool list). <br />4.2.2 Stream LLM tokens; enforce max-token and cost guardrails per tenant plan. <br />4.2.3 Track tool invocations, intermediate reasoning steps, and final output; persist to audit log. <br />4.2.4 Collect self-reported confidence and reasoning chain; expose to PDCA Manager. <br />4.2.5 Provide graceful cancel on user abort, budget exhaustion, or policy violation. |
| **4.3** | **Human Task Inbox** | 4.3.1 Unified inbox showing tasks assigned to the current user in real-time via Work World WebSocket. <br />4.3.2 “Claim / Delegate / Reject” controls with reason capture. <br />4.3.3 Inline forms for quick actions (approve doc, comment, upload artifact). <br />4.3.4 Smart reminders (e-mail and in-app) based on due-date heuristics. <br />4.3.5 Offline PWA cache and automatic sync when connection restores. |
| **4.4** | **PDCA-Feedback Manager** | 4.4.1 Record Plan → Do → Check → Act cycles for every task; auto-generate “Check” entries from test results or reviewer feedback. <br />4.4.2 Compute ROI delta and quality score after execution; feed results to the Scheduler for continuous improvement. <br />4.4.3 Surface actionable insights (recurring bottleneck roles, tool latency spikes). <br />4.4.4 Provide one-click “Apply improvement” to update Playbook and WBS templates. |
| **4.5** | **Exception Handling & Escalation** | 4.5.1 Detect task failures, SLA breaches, budget overruns, and policy violations. <br />4.5.2 Apply automatic retry matrix (immediate, exponential back-off, alternate agent). <br />4.5.3 Execute escalation rules (notify role X after N retries, page on-call via SMS/Slack). <br />4.5.4 Offer incident console with root-cause links (logs, traces, diffs). <br />4.5.5 Auto-generate a post-mortem template once the incident is resolved. |
| **4.6** | **Work World Live Interface (HumanWorker Portal)** | 4.6.1 Browser session authenticates as `HumanWorker` and establishes a secure WebSocket connection to the Work World. <br />4.6.2 Receive and render all events addressed to that worker: task assignments, agent messages, status updates, escalations, chat prompts, and streaming agent output. <br />4.6.3 Presence detection and heartbeat (online/offline status with idle timeout). <br />4.6.4 Provide bi-directional channel: worker can send replies, comments, and file uploads directly to the task context; supports Markdown and attachments. <br />4.6.5 Include in-context live chat panel between the human and active Action Agent with full history. <br />4.6.6 Ensure accessibility (WCAG 2.1 AA) for keyboard-only use, screen readers, and high-contrast modes. |
| **4.7** | **Human-Agent Collaboration UI** | 5.5.1 Real-time chat thread embedded in each task, showing agent reasoning steps and human comments. <br />5.5.2 “Accept / Reject / Ask Clarification” quick reactions on agent outputs. <br />5.5.3 Inline file upload and Markdown editing; agent can request specific files or confirmations. <br />5.5.4 Conversation history is persisted and linked to the task audit trail. <br />5.5.5 Optional voice note recording and playback for hands-free collaboration. |
